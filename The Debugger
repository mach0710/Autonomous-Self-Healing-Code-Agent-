def debug_node(state: AgentState):
    print("--- DEBUGGING ---")
    
    prompt = ChatPromptTemplate.from_messages([
        ("system", "You are a Debugging Assistant. Fix the code based on the error trace."),
        ("user", "Original Code:\n{code}\n\nError Trace:\n{error}\n\nReturn the FIXED code only.")
    ])
    chain = prompt | llm
    result = chain.invoke({"code": state['code'], "error": state['error']})
    
    clean_code = result.content.replace("```python", "").replace("```", "").strip()
    return {"code": clean_code}
